## Projecte basat en el treball de:
[https://github.com/Matchstic/Apache2-PHP-SSL-Docker]

## Autor
Gabriel Denis Llanes

## Doc prèvia

La funció d'aquest projecte és proporcionar una plantilla per a crear un servidor Apache amb les eines necessàries per poder autentificar la web que hosteja amb HTTPS mitjançant certbot

S'han introduït canvis en el fitxer de"./webserver/Dockerfile" modificant les dues variables d'entorn

- ENV DOMAINS "areportvilacat.ddns.net"  -> Domini de la nostra web, cal que estigui publicada en la xarxa. Es poden publicar diferents dominis si els separem amb comes.

- ENV WEBMASTER_MAIL "gabydll95@gmail.com" -> Correu del que manté la web, el meu ara mateix.

També se han modificat els arxius:
- docker-compose -> per muntar el servidor web conjuntament amb altres serveis
- project.env -> on es guardarien les variables d'entorn per a docker. Per alguna raó no acaba de funcionar per aquesta versió de compose, es recomana declarar-les en el fitxer directament
                -> https://docs.docker.com/compose/environment-variables/

## Modificacions per al arxiu Dockerfile

L'arxiu de Dokerfile, en l'apartat d'instal·lació d'Apache, s'instal·len eines com PHP que poder no són necessàries per al projecte, es recomana que no s'instal·lin sinó són absolutament necessàries.

També es pot instal·lar una imatge d'Ubuntu diferent de la xenial, que ve per defecte.

## Com funciona

Hi ha dues carpetes creades
    1- Apache_config: Contindrà la configuració de les webs que tenim (arxiu.conf). Es poden guardar en aquesta carpeta o actualitzar el arxiu docker-compose perquè apunti al nou lloc
    2- Apache_files: Conté els fitxers de la web.
    3- ./webserver/configs: Configuracions de sistema per apache, es recomana no tocar-les, almenys que sigui necessari.

## Requeriments, funcionament

1- Cal un domini web propi comprat o publicat en alguna web com les descrites aquí : https://www.buildthis.io/growth/free-domains/
    o per exemple, https://www.noip.com/ . Compte, el domini ha de estar dins dels dominis llistats a https://publicsuffix.org/list/  
2- Cal que la maquina host permeti el pas a la web, amb els "port forwarding" configurat i habilitat al router. Normalment, es pot comprovar el funcionament en la pàgina
 https://www.portchecktool.com/

## Per a executar:

```
docker-compose up --build 
````
O amb la opciò -d per a que funcioni en segon plà.

## Altres opcions
Si es vol, es poden fer probes locals seguint aquest post:

https://stackoverflow.com/questions/43752615/enable-apache-ssl-in-docker-for-local-development





## Docker -- Apache+PHP with SSL via Let's Encrypt

Provides a docker image containing `apache2`, `PHP` and SSL certs generated by Let's Encrypt.

### Instructions

Run the container via:

```
docker run --rm \
    -v ${DOCUMENT_ROOT}:/var/www/ \
    -v ${SITES_ENABLED}:/etc/apache2/sites-enabled \
    -p 80:80 \
    -p 443:443 \
    -e "DOMAINS=" \
    -e "WEBMASTER_MAIL=" \
    --name httpd-php-ssl \
    matchstic/httpd-php-ssl:latest
```

### Configuration

- `${DOCUMENT_ROOT}` is the directory on the host containing HTML etc.
- `${SITES_ENABLED}` is a directory containing `.conf` files detailing virtual hosts for Apache.
- `DOMAINS` is a comma-seperated list of domains to fetch SSL certificates for.
- `WEBMASTER_MAIL` is self-explanatory.

### VirtualHost setup

Each `.conf` in `${SITES_ENABLED}` should follow the template:

```
<VirtualHost *:80>
    ServerName example.com
    ServerAlias example.com
    DocumentRoot /var/www/
</VirtualHost>

<VirtualHost *:443>
    ServerName example.com
    ServerAlias example.com
    DocumentRoot /var/www/

    SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
```

### Extra details

See the following for details (after all, I based this container on them!):

- [https://github.com/romeOz/docker-apache-php](https://github.com/romeOz/docker-apache-php)
- [https://github.com/BirgerK/docker-apache-letsencrypt](https://github.com/BirgerK/docker-apache-letsencrypt)

### License

Licensed under the MIT license.
